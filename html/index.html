<!doctype html>
<html>

<head>
	<meta charset="UTF-8" />
	<title>BuildBridge</title>
	<script type="text/javascript">
	if(location.href.indexOf(':8000') != -1) document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')
	</script>
	<script src="./js/plugin/jquery-1.9.1.min.js"></script>
	<script src="./js/plugin/jquery-ui-1.9.2.custom.min.js"></script>
	<script src="./js/plugin/jquery-ui-1.9.2.custom.min.js"></script>
	<script src="./js/plugin/jquery.easing.1.3.js"></script>
	<script src="./js/plugin/jquery.transform.js"></script>
	<link rel="stylesheet" type="text/css" href="./css/style.css">
</head>

<body>
	<div class="blGroup">
		<div class="guideline"></div>
		<div class="blGroupInBox">
			<div class="box b_bar bBar"></div>
		</div>
	</div>
	<script type="text/javascript">
	//var gamePath = Game.gamePath[Game.gameCode]; //폴더경로 변경값
	jQuery(document).ready(function($) {
		var YBM_GAME_TYPE05 = function(obj) {
			this.obj = $.extend({
				contr: {
					left: 0,
					right: 0,
					drop: 32,
				},
				box: ['130', '190', '160', '100', '230', '80'],
				random: false,
				boxAppendWrap: '.blGroupInBox',
				boxAddClass: '.dropBox',
				boxInitClass: '.box',
			}, obj);
			this.success = true;
			this.crrtDropBox = null;
			this.crrtBoxCount = 0;
			this.nextDropBox = null;
			this.prevDropBox = null;
			this.prevDropBoxArry = [];
			this.crrtDropBoxObj = {};
			this.nextDropBoxObj = {};
			this.prevDropBoxObj = {};
			this.limitGuideLine = {
				width : 470,
				left : 165,
				right : 470+165
			};
			this.boxCount = 0;
			this.boxHeight = 0;
			this.boxArry = [];
			this.boxAppendHtml = '';
			this.init();
		};
		YBM_GAME_TYPE05.prototype = {
			init: function(obj) {
				this.set();
				this.crrtDropBox = $('.bBar');
				this.boxPrevNextFun();
				//this.setSuccess();
				this.setBoxHeight();
				this.dropBind();
			},
			set: function() {
				if(!this.obj.random) {
					var _this = this;
					this.obj.box.forEach(function(items, count) {
						_this.boxAppendHtml += '<div class="box w' + items + ' ' + _this.glFun().clsFormat(_this.obj.boxAddClass) + '" style="width: ' + items + 'px" data-count="' + count + '" data-box-width="' + items + '"></div>';
					});
					$(this.obj.boxAppendWrap).append(this.boxAppendHtml+'<div class="box" style="display: none;"></div>');
				}
			},
			boxPrevNextFun: function($target) {
				var _this = this;
				var $target = $target ? $target : this.crrtDropBox;
				this.nextDropBox = $target.next();
				if($target.prev().is('.box')) {
					// this.prevDropBox = $target.prev();
					var $prev = $target.prev();
					this.prevDropBoxArry.push($prev);
					console.log(this.prevDropBoxArry)
					this.prevDropBoxArry.forEach(function(items){
						if(!items.is(':hidden')){
							_this.prevDropBox = items;
							return;
						}
					});
					this.prevDropBoxObj = this.setBoxPosition(this.prevDropBox);
				}
				this.nextDropBoxObj = this.setBoxPosition(this.nextDropBox);
				this.crrtDropBoxObj = this.setBoxPosition(this.crrtDropBox);
			},
			setBoxPosition: function($target) {
				var $target = $target ? $target : this.crrtDropBox;
				var pos = {
					w: $target.outerWidth(),
					h: $target.outerHeight(),
					x: $target[0].offsetLeft,
					y: $target[0].offsetTop,
					r: $target.outerWidth() + $target[0].offsetLeft,
				};
				return {
					width: pos.w,
					height: pos.h,
					left: pos.x,
					top: pos.y,
					right: pos.r,
				};
			},
			setSuccess: function(bo) {
				if(this.crrtDropBoxObj.left > this.limitGuideLine.left && this.crrtDropBoxObj.right < this.limitGuideLine.right) {
					this.success = true;
					this.setLimitGuideLine(this.crrtDropBoxObj, this.nextDropBoxObj);
				} else {
					this.success = false;
					this.setLimitGuideLine(this.prevDropBoxObj, this.nextDropBoxObj);
				}
			},
			setLimitGuideLine: function(prev, crrt) {
				var w = prev.width + crrt.width;
				var x = prev.left - (crrt.width / 2);
				var wx = w + x;
				this.limitGuideLine = {
					width: w,
					left: x,
					right: wx,
				};
				$('.guideline').stop().animate({
					'width': this.limitGuideLine.width,
					'left': this.limitGuideLine.left,
				});
			},
			setBoxHeight: function() {
				if(this.success) {
					this.boxHeight += this.setBoxPosition().height;
				}
			},
			dropBind: function() {
				var _this = this;
				$(document).keyup(function() {
					if(event.keyCode == _this.obj.contr.drop) {
						_this.crrtDropBox = $(_this.obj.boxAddClass + '[data-count=' + _this.boxCount + ']');
						_this.boxPrevNextFun();
						_this.setSuccess();
						_this.setBoxHeight();
						_this.dropMove();
					}
				});
			},
			dropMove: function() {
				this.crrtDropBox.css({
					'top': $(document).height() - this.boxHeight
				});
				if(!this.success) {
					 // this.crrtDropBox.animate({ 'opacity': 0 }, { 'complete': function() { $(this).hide(); } });
					 this.crrtDropBox.hide();
				}
				this.boxCount++;
			},
			glFun: function() {
				var clsFormat = function(nm) {
					return nm.replace('.', '');
				};
				return {
					clsFormat: clsFormat,
				};
			},
		};
		var initName = new YBM_GAME_TYPE05({});
	});
	</script>
</body>

</html>